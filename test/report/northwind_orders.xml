<?xml version="1.0" encoding="utf-8"?>
<Report>
  <Name>orders</Name>
  <Description>Northwind Orders</Description>
  <Author>Fredy Ramirez</Author>
  <Page/>
  <ReportParameters>
    <ReportParameter>
      <Name>conn_string</Name>
      <DataType>String</DataType>
      <DefaultValue>''</DefaultValue>
    </ReportParameter>
  </ReportParameters>
  <Body>
    <ReportItems>
      <Tablix>
        <Name>TablixOrder</Name>
        <Left>1in</Left>
        <TablixColumnHierarchy>
          <TablixMembers>
            <TablixMember/>
            <TablixMember/>
            <TablixMember/>
            <TablixMember/>
            <TablixMember/>
            <TablixMember/>
            <TablixMember/>
          </TablixMembers>
        </TablixColumnHierarchy>
        <TablixRowHierarchy>
          <TablixMembers>
            <TablixMember>
              <RepeatOnNewPage>true</RepeatOnNewPage>
            </TablixMember>
            <TablixMember>
              <Group>
                <Name>country</Name>
                <GroupExpressions>
                  <GroupExpression>=F.country</GroupExpression>
                </GroupExpressions>
                <SortExpressions>
                  <SortExpression>
                    <Value>=F.country</Value>
                  </SortExpression>
                </SortExpressions>
              </Group>
              <TablixMembers>
                <TablixMember>
                  <RepeatOnNewPage>true</RepeatOnNewPage>
                </TablixMember>
                <TablixMember>
                  <Group>
                    <Name>date</Name>
                    <GroupExpressions>
                      <GroupExpression>=F.date</GroupExpression>
                    </GroupExpressions>
                    <SortExpressions>
                      <SortExpression>
                        <Value>=F.date</Value>
                      </SortExpression>
                    </SortExpressions>
                  </Group>
                  <TablixMembers>
                    <TablixMember>
                      <RepeatOnNewPage>true</RepeatOnNewPage>                      
                    </TablixMember>
                    <TablixMember>
                      <Group>
                        <Name>customer</Name>
                        <GroupExpressions>
                          <GroupExpression>=F.customer</GroupExpression>
                        </GroupExpressions>
                        <SortExpressions>
                          <SortExpression>
                            <Value>=F.customer</Value>
                          </SortExpression>
                        </SortExpressions>
                      </Group>
                      <TablixMembers>
                        <TablixMember>
                          <RepeatOnNewPage>true</RepeatOnNewPage>                      
                        </TablixMember>
                        <TablixMember>
                          <Group>
                            <Name>orderid</Name>
                            <GroupExpressions>
                              <GroupExpression>=F.orderid</GroupExpression>
                            </GroupExpressions>
                            <SortExpressions>
                              <SortExpression>
                                <Value>=F.orderid</Value>
                              </SortExpression>
                            </SortExpressions>
                          </Group>
                          <TablixMembers>
                            <TablixMember>
                              <RepeatOnNewPage>true</RepeatOnNewPage>
                            </TablixMember>
                            <TablixMember>
                              <Group>
                                <Name>details</Name>
                                <SortExpressions>
                                  <SortExpression>
                                    <Value>=F.product</Value>
                                  </SortExpression>
                                </SortExpressions>
                              </Group>
                            </TablixMember>
                            <TablixMember>
                              <!-- total order -->
                              <RepeatOnNewPage>true</RepeatOnNewPage>
                            </TablixMember>
                          </TablixMembers>
                        </TablixMember>
                        <TablixMember>
                          <!-- total customer -->
                          <RepeatOnNewPage>true</RepeatOnNewPage>
                        </TablixMember>
                      </TablixMembers>
                    </TablixMember>
                    <TablixMember>
                      <!-- total date -->
                      <RepeatOnNewPage>true</RepeatOnNewPage>
                    </TablixMember>
                  </TablixMembers>
                </TablixMember>
                <TablixMember>
                  <!-- total country -->
                  <RepeatOnNewPage>true</RepeatOnNewPage>
                </TablixMember>
              </TablixMembers>
            </TablixMember>
            <TablixMember>
              <!-- Grand Total -->
              <RepeatOnNewPage>true</RepeatOnNewPage>
            </TablixMember>
          </TablixMembers>
        </TablixRowHierarchy>
        <TablixBody>
          <TablixColumns>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
            <TablixColumn>
              <Width>2in</Width>
            </TablixColumn>
          </TablixColumns>
          <TablixRows>
            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>product_header</Name>
                        <Value>Product</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>qty_header</Name>
                        <Value>Qty</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>unit_header</Name>
                        <Value>Unit</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>discount_header</Name>
                        <Value>Discount</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>subtotal1_header</Name>
                        <Value>Total</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>discount_amount_header</Name>
                        <Value>Discount</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>total_header</Name>
                        <Value>Total</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <BackgroundColor>Aqua</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>7</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>country_header</Name>
                        <Value>=F.country</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>White</Color>
                          <BackgroundColor>Gray</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>7</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>date_header</Name>
                        <Value>=F.date</Value>                    
                        <Style>
                          <Format>{:%A, %m-%d-%Y}</Format>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>White</Color>
                          <BackgroundColor>Red</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>7</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>customer_header</Name>
                        <Value>=F.customer</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>White</Color>
                          <BackgroundColor>Blue</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>7</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>order_header</Name>
                        <Value>=F.orderid</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>White</Color>
                          <BackgroundColor>Violet</BackgroundColor>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>
            <TablixRow>
              <Height>8mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>product</Name>
                        <CanGrow>true</CanGrow>
                        <Value>=F.product</Value>
                        <Style>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>qty</Name>
                        <Value>=F.quantity</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>unit</Name>
                        <Value>=F.unitprice</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>                        
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>discount1</Name>
                        <Value>=Fields.discount</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>                        
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>subtotal1</Name>
                        <Value>=F.subtotal1</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>discount2</Name>
                        <Value>=F.discount_amount</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ReportItems>
                      <Textbox>
                        <Name>total</Name>
                        <Value>=F.subtotal1 - F.discount_amount</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <PaddingLeft>2pt</PaddingLeft>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
              </TablixCells>
            </TablixRow>

            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>5</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_order</Name>
                        <Value>='Total Order ' + str(F.orderid)</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ColSpan>2</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_order_amount</Name>
                        <Value>=Aggr.Sum('F.subtotal1 - F.discount_amount')</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>                
              </TablixCells>
            </TablixRow>

            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>5</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_customer</Name>
                        <Value>='Total Customer ' + str(F.customer)</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Blue</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ColSpan>2</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_customer_amount</Name>
                        <Value>=Aggr.Sum('F.subtotal1 - F.discount_amount')</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Blue</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>                
              </TablixCells>
            </TablixRow>

            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>5</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_date</Name>
                        <Value>='Total Date ' + str(F.date)</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Red</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ColSpan>2</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_date_amount</Name>
                        <Value>=Aggr.Sum('F.subtotal1 - F.discount_amount')</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Red</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>                  
                  </CellContents>
                </TablixCell>                
              </TablixCells>
            </TablixRow>

            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>5</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_country</Name>
                        <Value>='Total Country ' + str(F.country)</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Gray</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ColSpan>2</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>total_country_amount</Name>
                        <Value>=Aggr.Sum('F.subtotal1 - F.discount_amount')</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                          <Color>Gray</Color>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>                
              </TablixCells>
            </TablixRow>

            <TablixRow>
              <Height>10mm</Height>
              <TablixCells>
                <TablixCell>
                  <CellContents>
                    <ColSpan>5</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>grand_total</Name>
                        <Value>Grand Total</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>
                <TablixCell>
                  <CellContents>
                    <ColSpan>2</ColSpan>
                    <ReportItems>
                      <Textbox>
                        <Name>grand_total_amount</Name>
                        <Value>=Aggr.Sum('F.subtotal1 - F.discount_amount')</Value>
                        <Style>
                          <TextAlign>Right</TextAlign>
                          <Border>
                            <Color>LightGrey</Color>
                            <BorderStyle>Solid</BorderStyle>
                          </Border>
                        </Style>
                      </Textbox>
                    </ReportItems>
                  </CellContents>
                </TablixCell>                
              </TablixCells>
            </TablixRow>
            
          </TablixRows>
        </TablixBody>
        <Style>
          <Border>
            <BorderStyle>Solid</BorderStyle>
          </Border>
        </Style>
        <DataSetName>OrderDataSet</DataSetName>
      </Tablix>
    </ReportItems>
    <Style/>
  </Body>
  <DataSources>
    <DataSource>
      <Name>datasource1</Name>
      <ConnectionProperties>
        <DataProvider>postgresql</DataProvider>
        <ConnectObject>=P.conn_string</ConnectObject>
      </ConnectionProperties>
    </DataSource>
  </DataSources>
  <DataSets>
    <DataSet>
      <Name>OrderDataSet</Name>
      <Query>
        <DataSourceName>datasource1</DataSourceName>
        <CommandText>SELECT orders.orderid, orders.orderdate, orders.customerid, 
customers.companyname, customers.country, 
order_details.productid, products.productname, products.categoryid, categories.categoryname, 
order_details.quantity, order_details.unitprice, order_details.discount 
FROM orders 
INNER JOIN customers ON orders.customerid = customers.customerid 
INNER JOIN order_details ON orders.orderid = order_details.orderid 
INNER JOIN products ON products.productid = order_details.productid 
INNER JOIN categories ON categories.categoryid = products.categoryid 
ORDER BY orders.orderid LIMIT 100</CommandText>
      </Query>
      <Fields>      
        <Field>
          <Name>orderid</Name>
          <DataField>orderid</DataField>
        </Field>
        <Field>
          <Name>date</Name>
          <DataField>orderdate</DataField>
        </Field>
        <Field>
          <Name>customer</Name>
          <DataField>companyname</DataField>
        </Field>
        <Field>
          <Name>country</Name>
          <DataField>country</DataField>
        </Field>
        <Field>
          <Name>product</Name>
          <DataField>productname</DataField>
        </Field>
        <Field>
          <Name>category</Name>
          <DataField>categoryname</DataField>
        </Field>
        <Field>
          <Name>quantity</Name>
          <DataField>quantity</DataField>
        </Field>
        <Field>
          <Name>unitprice</Name>
          <DataField>unitprice</DataField>
        </Field>
        <Field>
          <Name>discount</Name>
          <DataField>discount</DataField>
        </Field>
        <Field>
          <Name>subtotal1</Name>
          <Value>=F.quantity * F.unitprice</Value>
        </Field>
        <Field>
          <Name>discount_amount</Name>
          <Value>=F.subtotal1 * F.discount</Value>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
</Report>
